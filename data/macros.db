{"name":"Falemos Vaccinator by Viriato139ac","type":"script","author":"4uIWgsMlc1aoAakz","img":"modules/falemos/assets/img/falemos.svg","scope":"global","command":"//\n// falemos vaccinator 0.9\n// by Viriato139ac\n//\n\n// Número de jugadores y listado de nombres\n\nlet jugadores = [];\nfor (let user of game.users.keys()) {\n  // console.log(game.users.get(user).data.name)\n  jugadores.push(game.users.get(user).data.name);\n}\n\nconst numeroJugadores = jugadores.length;\nconst nombresJugadores = jugadores.join();\n\n// Calculo de la composición óptima en base al número de jugadores, 7 jugadores = 2x4, 4 jugadores = 2x2, lo hace minimizando filas+columnas\n\nlet temp1 = [];\nlet k = 1;\nfor (let i = 0; i < numeroJugadores; i++) {\n  for (let j = 0; j < numeroJugadores; j++) {\n    temp1.push({\n      rows: i + 1,\n      columns: j + 1,\n      slots: (j + 1) * (i + 1),\n      sum: j + i + 2,\n      valid: (j + 1) * (i + 1) >= numeroJugadores,\n    });\n    k++;\n  }\n}\n\nlet temp2 = temp1.filter((nnn) => nnn.valid);\nlet temp3 = temp2.sort(function (a, b) {\n  return a.sum - b.sum || a.rows - b.rows;\n});\nconst slotsOptimo = temp3[0];\n//console.log(slotsOptimo.rows + 'x' + slotsOptimo.columns)\n\n// Cálculo de los huecos vacíos por defecto, basado en el número de jugadores y los huecos disponibles\nlet temp4 = [];\nfor (let i = numeroJugadores + 1; i <= slotsOptimo.slots; i++) temp4.push(i);\nconst emptySlots = temp4.join();\n\nfunction twoDimensionArray(a, b) {\n  let arr = [];\n  for (let i = 0; i < a; i++) {\n    for (let j = 0; j < b; j++) {\n      arr[i] = [];\n    }\n  }\n  for (let i = 0; i < a; i++) {\n    for (let j = 0; j < b; j++) {\n      arr[i][j] = j;\n    }\n  }\n  return arr;\n}\n\n// Redondear 2 decimales\n\nfunction redondear2dec(num) {\n\treturn (Math.round(num*100))/100\n}\n\n// Esta función calcula las posiciones y anchos de los jugadores óptimas para una composición dada\n\nfunction falemosCalculator(\n  idimensiones,\n  imargenes,\n  ioverlays,\n  irejilla,\n  iseparacionminima,\n  iposiciongm,\n  ihuecosvacios,\n  inames\n) {\n  // Comprobaciones previas\n  // GM no puede ser nulo\n  if (iposiciongm === undefined) iposiciongm = 1;\n  // console.log(\"Posición del GM: \" + iposiciongm);\n  // Si GM es una de las posiciones vacías, se elimina esa posición vacía\n  if (!ihuecosvacios.every((num) => num !== iposiciongm))\n    ihuecosvacios = ihuecosvacios.filter((num) => num !== iposiciongm);\n  // console.log(\"Huecos vacíos: \" + ihuecosvacios);\n\n  const coorini = [Number(imargenes[0]), Number(imargenes[1])];\n  const coorfin = [\n    Number(idimensiones[0]) - Number(imargenes[2]),\n    Number(idimensiones[1]) - Number(imargenes[3]),\n  ];\n  // console.log(\"Coordenadas iniciales: \" + coorini);\n  // console.log(\"Coordenadas finales: \" + coorfin);\n\n  const ventana = [400, 300];\n  const ventanalayout = [\n    ventana[0] +\n      (ventana[0] * (Number(ioverlays[0]) + Number(ioverlays[2]))) / 100,\n    ventana[1] +\n      (ventana[1] * (Number(ioverlays[1]) + Number(ioverlays[3]))) / 100,\n  ];\n  // console.log(\"Ventana: \" + ventana);\n  // console.log(\"Ventana: layout: \" + ventanalayout);\n\n  let temp1 = [];\n  for (let i = 0; i < coorfin.length; i++)\n    temp1.push(\n      (coorfin[i] -\n        coorini[i] -\n        Number(iseparacionminima) * (Number(irejilla[i]) + 1)) /\n        Number(irejilla[i])\n    );\n  // console.log(temp1);\n  let temp2 = [];\n  for (let i = 0; i < coorfin.length; i++)\n    temp2.push(\n      (temp1[i] * ventanalayout[coorfin.length - i - 1]) / ventanalayout[i]\n    );\n  // console.log(temp2);\n\n  const wlayoutoptimo = Math.min(temp1[0], temp2[1]);\n  const hlayoutoptimo = Math.min(temp1[1], temp2[0]);\n  // console.log(\"Layout optimo (ancho): \" + wlayoutoptimo);\n  // console.log(\"Layout optimo (alto): \" + hlayoutoptimo);\n\n  const ventanafinallayout = [\n    wlayoutoptimo,\n    (wlayoutoptimo * ventanalayout[1]) / ventanalayout[0],\n  ];\n  const ventanafinal = [\n    ventanafinallayout[0] /\n      (1 + (Number(ioverlays[0]) + Number(ioverlays[2])) / 100),\n    ventanafinallayout[1] /\n      (1 + (Number(ioverlays[1]) + Number(ioverlays[3])) / 100),\n  ];\n  // console.log(\"Ventana final layout: \" + ventanafinallayout);\n  // console.log(\"Ventana final: \" + ventanafinal);\n\n  let espacios = [];\n  for (let i = 0; i < coorfin.length; i++)\n    espacios.push(\n      (coorfin[i] - coorini[i] - ventanafinallayout[i] * Number(irejilla[i])) /\n        (Number(irejilla[i]) + 1)\n    );\n  // console.log(\"Espacios: \" + espacios);\n\n  const resultado = twoDimensionArray(\n    Number(irejilla[0]) * Number(irejilla[1]),\n    16\n  );\n\n  let k = 0;\n  let l = 0;\n  for (let i = 0; i < irejilla[1]; i++) {\n    for (let j = 0; j < irejilla[0]; j++) {\n      let resultadoi = [\n        i + 1,\n        j + 1,\n        redondear2dec(\n          coorini[0] +\n            espacios[0] * (j + 1) +\n            ventanafinallayout[0] * j +\n            (ventanafinal[0] * Number(ioverlays[0])) / 100\n        ),\n        redondear2dec(\n          coorini[1] +\n            espacios[1] * (i + 1) +\n            ventanafinallayout[1] * i +\n            (ventanafinal[1] * Number(ioverlays[1])) / 100\n        ),\n        redondear2dec(ventanafinal[0]),\n        redondear2dec(ventanafinal[1]),\n        espacios[0],\n        espacios[1],\n        redondear2dec(\n          coorini[0] +\n            espacios[0] * (j + 1) +\n            ventanafinallayout[0] * j +\n            (ventanafinal[0] * Number(ioverlays[0])) / 100 -\n            (ventanafinal[0] * Number(ioverlays[0])) / 100\n        ),\n        redondear2dec(\n          coorini[1] +\n            espacios[1] * (i + 1) +\n            ventanafinallayout[1] * i +\n            (ventanafinal[1] * Number(ioverlays[1])) / 100 -\n            (ventanafinal[1] * Number(ioverlays[1])) / 100\n        ),\n        redondear2dec(ventanafinallayout[0]),\n        redondear2dec(ventanafinallayout[1]),\n        redondear2dec(\n          ((coorini[0] +\n            espacios[0] * (j + 1) +\n            ventanafinallayout[0] * j +\n            (ventanafinal[0] * Number(ioverlays[0])) / 100) /\n            Number(idimensiones[0])) *\n            100\n        ),\n        redondear2dec(\n          ((coorini[1] +\n            espacios[1] * (i + 1) +\n            ventanafinallayout[1] * i +\n            (ventanafinal[1] * Number(ioverlays[1])) / 100) /\n            Number(idimensiones[1])) *\n            100\n        ),\n        redondear2dec((ventanafinal[0] / Number(idimensiones[0])) * 100),\n        redondear2dec((ventanafinal[1] / Number(idimensiones[1])) * 100),\n      ];\n\n      resultadoi.push(ihuecosvacios.every((num) => num !== k + 1));\n      resultadoi.push(Number(iposiciongm) === k + 1);\n      if (ihuecosvacios.every((num) => num !== k + 1)) {\n        resultadoi.push(inames[l]);\n        l++;\n      } else {\n        resultadoi.push(\"Vacío\");\n      }\n\n      resultado[k] = resultadoi;\n      k++;\n    }\n  }\n  // console.log(resultado);\n\n  const resultadofinal1 = resultado.filter((arr) => arr[17]);\n  const resultadofinal2 = resultado.filter((arr) => arr[16] && !arr[17]);\n  // console.log(resultadofinal1)\n  // console.log(resultadofinal2)\n  const resultadofinal = resultadofinal1.concat(resultadofinal2);\n  // console.log(resultadofinal)\n  return resultadofinal;\n}\n\n// Aquí se comienza a definir el formulario de entrada de datos\n\nlet applyChanges = false;\nlet saveMacro = false;\nnew Dialog({\n  title: `${game.i18n.localize(\"FALEMOS.vaccinator.title\")}`,\n  content: `\n  <script>function selectImage(){\n    const fp1 = new FilePicker({\n       type: \"image\",\n       button: \"image-picker\",\n       callback: (url) => {\n          $(\"#marcos\").val(url);\n       }\n    });\n    fp1.browse();\n    }\n  </script>\n  <script>function selectImageMult() {\n    const fp2 = new FilePicker({\n       type: \"image\",\n       button: \"image-picker\",\n       callback: (url) => {\n        $(\"#marcos\").val() === \"\"\n        ? $(\"#marcos\").val(url) \n        : $(\"#marcos\").val([$(\"#marcos\").val(),url].join());\n       }\n    });\n    fp2.browse();\n    }\n  </script>\n  <script>function simularTabla(nuFilas, nuColumnas,nuJugadores,poGM,poHuecos,naJugadores){\n    nuFilas= Number(nuFilas)\n    nuColumnas= Number(nuColumnas)\n    nuJugadores= Number(nuJugadores)\n    poGM= Number(poGM)\n    // Si hay más jugadores que la disposición\n    nuJugadores = Math.min(nuFilas*nuColumnas,nuJugadores);\n    // Si GM> nuJugadores o GM<1\n    if (poGM<1) poGM=1;\n    if (poGM>nuJugadores) poGM=nuJugadores;\n    let poHuecosa = poHuecos.split(\",\").map(num => Number(num));\n    let naJugadoresa = naJugadores.split(\",\");\n    // Si GM es una de las posiciones vacías, se elimina esa posición vacía\n    if (!poHuecosa.every((num) => num !== poGM))\n    poHuecosa = poHuecosa.filter((num) => num !== poGM);\n    //console.log('GM:' + poGM + ' Ju:' + nuJugadores + ' Hu:' + poHuecosa)\n\t//console.log('Nombres:' + naJugadoresa)\n    let tabla = '<table align=\"center\" style=\"margin: 0px auto;\"\">' + '\\\\n' + '<tbody>\\\\n';\n    let k = 1;\n    let h = 1;\n    let l = 1;\n    for (let i=0;i<nuFilas;i++){\n        tabla = tabla + '<tr>\\\\n';\n        for (let j=0;j<nuColumnas;j++){\n\t\t    //console.log(i+1 + 'x' + j+1 + '=' + k + h + l);\n            if (poHuecosa.some(num => num === k)){\n                tabla = tabla + '<td style=\"text-align:center;background-color:#EC7063\">' + '${game.i18n.localize(\"FALEMOS.vaccinator.simulateEmpty\")}' + '</td>\\\\n';\n            }else if(k === poGM){\n                if(naJugadoresa[0]=== undefined || naJugadoresa[0]===\"\"){\n                    tabla = tabla + '<td style=\"text-align:center;background-color:#3498DB\">' + '${game.i18n.localize(\"FALEMOS.vaccinator.simulateEmpty\")}' + '</td>\\\\n';\n                }else{\n                    tabla = tabla + '<td style=\"text-align:center;background-color:#3498DB\">' + naJugadoresa[0] + '</td>\\\\n';\n                }\n            }else if(l>(nuJugadores-1)){\n                tabla = tabla + '<td style=\"text-align:center;background-color:#EC7063\">' + '${game.i18n.localize(\"FALEMOS.vaccinator.simulateEmpty\")}' + '</td>\\\\n';\n            }else if(naJugadoresa[h]=== undefined || naJugadoresa[h]===\"\"){\n                tabla = tabla + '<td style=\"text-align:center;background-color:#F7DC6F\">' + '${game.i18n.localize(\"FALEMOS.vaccinator.simulateUndefined\")}' + '</td>\\\\n';\n                l++;\n            }else{\n                tabla = tabla + '<td style=\"text-align:center;background-color:#58D68D\">' + naJugadoresa[h]+ '</td>\\\\n';\n                h++;\n                l++;\n            }\n            k++\n        }    \n        tabla = tabla + '</tr>\\\\n';\n    }\n    tabla = tabla + '</tbody>\\\\n</table>';\n    //console.log(tabla)\n    new Dialog({\n        title: '${game.i18n.localize(\"FALEMOS.vaccinator.simulateTable\")}',\n        content: tabla ,\n        buttons: {\n          yes: {\n            icon: \"<i class='fas fa-chevron-circle-left'></i>\",\n            label: '${game.i18n.localize(\"FALEMOS.vaccinator.return\")}',\n          },\n        },\n        default: \"yes\",\n        close: (html) => {\n        },\n      }).render(true);\n    }\n  </script>  \n  <form>\n  <div class=\"form-group\">\n    <label>${game.i18n.localize(\"FALEMOS.vaccinator.width\")}:</label>\n    <input type=\"number\" id=\"ancho\" name=\"ancho\" min=1 value=${\n      window.innerWidth\n    }>\n    <label>${game.i18n.localize(\"FALEMOS.vaccinator.height\")}:</label>\n    <input type=\"number\" id=\"alto\" name=\"alto\" min=1 value=${\n      window.innerHeight\n    }>\n  </div>\n  <p class=\"notes\">\n  <b>${game.i18n.localize(\n    \"FALEMOS.vaccinator.width\"\n  )}</b>: ${game.i18n.localize(\n    \"FALEMOS.vaccinator.widthHint\"\n  )}; <b>${game.i18n.localize(\n    \"FALEMOS.vaccinator.height\"\n  )}</b>: ${game.i18n.localize(\"FALEMOS.vaccinator.heightHint\")}</p>\n  <div class=\"form-group\">\n    <label>${game.i18n.localize(\"FALEMOS.vaccinator.margins\")}:</label>\n    <input type=\"number\" id=\"marizq\" name=\"marizq\" min=0 value=${\n      2 * document.getElementById(\"controls\").clientWidth\n    }>\n    <input type=\"number\" id=\"mararr\" name=\"mararr\" min=0 value=${\n      document.getElementById(\"scene-list\") === null ? 50 : document.getElementById(\"scene-list\").clientHeight\n    }>\n  <input type=\"number\" id=\"marder\" name=\"marder\" min=0 value=${\n    document.getElementById(\"sidebar\").offsetWidth\n  }>\n  <input type=\"number\" id=\"maraba\" name=\"maraba\" min=0 value=${\n    document.getElementById(\"macro-list\").clientHeight\n  }>\n  </div>\n  <p class=\"notes\">${game.i18n.localize(\"FALEMOS.vaccinator.marginsHint\")}</p>\n  <div class=\"form-group\">\n  <label>${game.i18n.localize(\"FALEMOS.vaccinator.users\")}:</label>\n  <input type=\"number\" id=\"nuusers\" name=\"nuusers\" value=${numeroJugadores} disabled><br><br>\n    <label>${game.i18n.localize(\"FALEMOS.vaccinator.rows\")}:</label>\n    <input type=\"number\" id=\"nRows\" name=\"nRows\" min=1 value=${\n      slotsOptimo.rows\n    }>\n    <label>${game.i18n.localize(\"FALEMOS.vaccinator.columns\")}:</label>\n    <input type=\"number\" id=\"nCols\" name=\"nCols\" min=1 value=${\n      slotsOptimo.columns\n    }>\n  </div>\n  <p class=\"notes\"><b>${game.i18n.localize(\n    \"FALEMOS.vaccinator.rows\"\n  )}</b>: ${game.i18n.localize(\n    \"FALEMOS.vaccinator.rowsHint\"\n  )}; <b>${game.i18n.localize(\n    \"FALEMOS.vaccinator.columns\"\n  )}</b>: ${game.i18n.localize(\"FALEMOS.vaccinator.columnsHint\")}</p>\n  <div class=\"form-group\">\n    <label>${game.i18n.localize(\"FALEMOS.vaccinator.gmposition\")}:</label>\n    <input type=\"number\" id=\"posgm\" name=\"posgm\" min=1 value=1>\n    <label>${game.i18n.localize(\"FALEMOS.vaccinator.emptyslots\")}:</label>\n    <input type=\"text\" id=\"huecos\" name=\"huecos\" value=\"${emptySlots}\">\n\t<button id=\"simular\" onclick='simularTabla(document.getElementById(\"nRows\").value,\n\t\tdocument.getElementById(\"nCols\").value,\n\t\tdocument.getElementById(\"nuusers\").value,\n\t\tdocument.getElementById(\"posgm\").value,\n\t\tdocument.getElementById(\"huecos\").value,\n\t\tdocument.getElementById(\"nombres\").value)' type=\"button\">${game.i18n.localize(\"FALEMOS.vaccinator.simulate\")}</button>\n  </div>\n  <p class=\"notes\"><b>${game.i18n.localize(\"FALEMOS.vaccinator.gmposition\")}</b>: ${game.i18n.localize(\"FALEMOS.vaccinator.gmpositionHint\")}; <b>${game.i18n.localize(\"FALEMOS.vaccinator.emptyslots\")}</b>:  ${game.i18n.localize(\"FALEMOS.vaccinator.emptyslotsHint\")}; <b>${game.i18n.localize(\"FALEMOS.vaccinator.simulate\")}</b>:  ${game.i18n.localize(\"FALEMOS.vaccinator.simulateHint\")}</p>\n  <div class=\"form-group\">\n    <label>${game.i18n.localize(\"FALEMOS.vaccinator.separation\")}:</label>\n    <input type=\"number\" id=\"sepmin\" name=\"sepmin\" min=0 value=10>\n  </div>\n  <p class=\"notes\">${game.i18n.localize(\n    \"FALEMOS.vaccinator.separationHint\"\n  )}</p>\n  <div class=\"form-group\">\n    <label>${game.i18n.localize(\"FALEMOS.vaccinator.frames\")}:</label>\n    <input type=\"text\" id=\"marcos\" name=\"marcos\" value=\"\">\n    <button id=\"marcosSeleccionar\" onclick=\"selectImageMult()\" type=\"button\">${game.i18n.localize(\n      \"File Path\"\n    )}</button>\n  </div>\n  <p class=\"notes\">${game.i18n.localize(\"FALEMOS.vaccinator.framesHint\")}</p>\n  <div class=\"form-group\">\n    <label>${game.i18n.localize(\"FALEMOS.vaccinator.overlays\")}:</label>\n    <input type=\"number\" id=\"oveizq\" name=\"oveizq\" min=\"0\" value=\"0\">\n    <input type=\"number\" id=\"ovearr\" name=\"ovearr\" min=\"0\" value=\"0\">\n    <input type=\"number\" id=\"oveder\" name=\"oveder\" min=\"0\" value=\"0\">\n    <input type=\"number\" id=\"oveaba\" name=\"oveaba\" min=\"0\" value=\"0\">\n  </div>\n  <p class=\"notes\">${game.i18n.localize(\"FALEMOS.vaccinator.overlaysHint\")}</p>\n  <div class=\"form-group\">\n  <label>${game.i18n.localize(\"FALEMOS.CameraGeometryText\")}:</label>\n  <select id=\"geometria\" name=\"geometria\">\n    <option value=\"rectangle\">${game.i18n.localize(\n      \"FALEMOS.camera.geometry.rectangle\"\n    )}</option>\n    <option value=\"circle\">${game.i18n.localize(\n      \"FALEMOS.camera.geometry.circle\"\n    )}</option>\n    <option value=\"triangle\">${game.i18n.localize(\n      \"FALEMOS.camera.geometry.triangle\"\n    )}</option>\n    <option value=\"rhombus\">${game.i18n.localize(\n      \"FALEMOS.camera.geometry.rhombus\"\n    )}</option>\n    <option value=\"hexagon\">${game.i18n.localize(\n      \"FALEMOS.camera.geometry.hexagon\"\n    )}</option>\n    <option value=\"star\">${game.i18n.localize(\n      \"FALEMOS.camera.geometry.star\"\n    )}</option>\n    <option value=\"shield\">${game.i18n.localize(\n      \"FALEMOS.camera.geometry.shield\"\n    )}</option>\n  </select>\n  </div>\n  <p class=\"notes\">${game.i18n.localize(\"FALEMOS.CameraGeometryNotes\")}</p>\n  <div class=\"form-group\">\n    <label>${game.i18n.localize(\"FALEMOS.CameraEffectText\")}:</label>\n    <select id=\"efecto\" name=\"efecto\">\n      <option value=\"NONE\">${game.i18n.localize(\n        \"FALEMOS.camera.effects.none\"\n      )}</option>\n      <option value=\"BW\">${game.i18n.localize(\n        \"FALEMOS.camera.effects.bw\"\n      )}</option>\n      <option value=\"Sepia\">${game.i18n.localize(\n        \"FALEMOS.camera.effects.sepia\"\n      )}</option>\n      <option value=\"Noise\">${game.i18n.localize(\n        \"FALEMOS.camera.effects.noise\"\n      )}</option>\n      <option value=\"Warp\">${game.i18n.localize(\n        \"FALEMOS.camera.effects.warp\"\n      )}</option>\n    </select>\n  </div>\n  <p class=\"notes\">${game.i18n.localize(\"FALEMOS.CameraEffectNotes\")}</p>\n  <div class=\"form-group\">\n    <label>${game.i18n.localize(\"FALEMOS.vaccinator.names\")}:</label>\n    <input type=\"text\" id=\"nombres\" name=\"nombres\" value=\"${nombresJugadores}\">\n  </div>\n  <p class=\"notes\">${game.i18n.localize(\"FALEMOS.vaccinator.namesHint\")}</p>\n  <div class=\"form-group\">\n    <label>${game.i18n.localize(\"FALEMOS.CameraNameFontText\")}:</label>\n\t<input type=\"text\" id=\"fuente\" name=\"fuente\" value=\"url('//db.onlinewebfonts.com/t/fe2027c27b6a24505f548c6fd2e1076d.woff') format('woff')\">\n  </div>\n  <p class=\"notes\">${game.i18n.localize(\"FALEMOS.CameraNameFontNotes\")}</p>\n  <div class=\"form-group\">\n    <label>${game.i18n.localize(\"FALEMOS.SceneFitText\")}:</label>\n    <select id=\"ajuste\" name=\"ajuste\">\n      <option value=\"nofit\">${game.i18n.localize(\n        \"FALEMOS.scene.fit.nofit\"\n      )}</option>\n      <option value=\"cover\">${game.i18n.localize(\n        \"FALEMOS.scene.fit.cover\"\n      )}</option>\n      <option value=\"contain\">${game.i18n.localize(\n        \"FALEMOS.scene.fit.contain\"\n      )}</option>\n    </select>\n  </div>\n  <p class=\"notes\">${game.i18n.localize(\"FALEMOS.SceneFitNotes\")}</p>\n</form>\n`,\n  buttons: {\n    yes: {\n      icon: \"<i class='fas fa-check-circle'></i>\",\n      label: `${game.i18n.localize(\"FALEMOS.vaccinator.apply\")}`,\n      callback: () => (applyChanges = true),\n    },\n    no: {\n      icon: \"<i class='fas fa-times-circle'></i>\",\n      label: `${game.i18n.localize(\"FALEMOS.vaccinator.cancel\")}`,\n    },\n    save: {\n      icon: \"<i class='fas fa-plus-circle'></i>\",\n      label: `${game.i18n.localize(\"FALEMOS.ExportConfigToMacro\")}`,\n      callback: () => {\n        applyChanges = true;\n        saveMacro = true;\n      },\n    },\n  },\n  default: \"yes\",\n  close: (html) => {\n    if (applyChanges) {\n      let ancho = html.find('[name=\"ancho\"]')[0].value || 1;\n      let alto = html.find('[name=\"alto\"]')[0].value || 1;\n      let marizq = html.find('[name=\"marizq\"]')[0].value || 0;\n      let mararr = html.find('[name=\"mararr\"]')[0].value || 0;\n      let marder = html.find('[name=\"marder\"]')[0].value || 0;\n      let maraba = html.find('[name=\"maraba\"]')[0].value || 0;\n      let nRows = html.find('[name=\"nRows\"]')[0].value || 1;\n      let nCols = html.find('[name=\"nCols\"]')[0].value || 1;\n      let sepmin = html.find('[name=\"sepmin\"]')[0].value || 0;\n      let posgm = html.find('[name=\"posgm\"]')[0].value || 1;\n      let huecos = html.find('[name=\"huecos\"]')[0].value;\n      let marcos = html.find('[name=\"marcos\"]')[0].value;\n      let oveizq = html.find('[name=\"oveizq\"]')[0].value || 0;\n      let ovearr = html.find('[name=\"ovearr\"]')[0].value || 0;\n      let oveder = html.find('[name=\"oveder\"]')[0].value || 0;\n      let oveaba = html.find('[name=\"oveaba\"]')[0].value || 0;\n      let nombres = html.find('[name=\"nombres\"]')[0].value;\n      let geometria = html.find('[name=\"geometria\"]')[0].value;\n      let efecto = html.find('[name=\"efecto\"]')[0].value;\n      let fuente = html.find('[name=\"fuente\"]')[0].value;\n      let ajuste = html.find('[name=\"ajuste\"]')[0].value;\n\n      const idimensiones = [ancho, alto];\n      const imargenes = [marizq, mararr, marder, maraba];\n      const ioverlays = [oveizq, ovearr, oveder, oveaba];\n      const irejilla = [nCols, nRows];\n      const iseparacionminima = sepmin;\n      const iposiciongm = posgm;\n      const ihuecosvaciostxt = huecos.split(\",\");\n      const ihuecosvacios = ihuecosvaciostxt.map((num) => Number(num));\n      const inames = nombres.split(\",\");\n      const imarcos = marcos.split(\",\");\n\n      console.log(\"---------------------------------\");\n      console.log(\"----   Falemos vaccinator   -----\");\n      console.log(\"---------------------------------\");\n      console.log(\"Dimensiones: \" + idimensiones);\n      console.log(\"Márgenes: \" + imargenes);\n      console.log(\"Marcos: \" + imarcos);\n      console.log(\"Overlays del marco: \" + ioverlays);\n      console.log(\"Rejilla: \" + irejilla);\n      console.log(\"Separación mínima: \" + iseparacionminima);\n      console.log(\"Posición GM: \" + iposiciongm);\n      console.log(\"Huecos vacíos: \" + ihuecosvacios);\n      console.log(\"Nombres: \" + inames);\n      console.log(\"Número de jugadores: \" + numeroJugadores);\n      console.log(\"Nombres de jugadores: \" + nombresJugadores);\n\n      console.log(\"---------------------------------\");\n\n      let resultadofinal = falemosCalculator(\n        idimensiones,\n        imargenes,\n        ioverlays,\n        irejilla,\n        iseparacionminima,\n        iposiciongm,\n        ihuecosvacios,\n        inames\n      );\n      console.log(\"Resultado final: \");\n      console.log(resultadofinal);\n      console.log(\"---------------------------------\");\n\n      // calculos del tamaño de fuente, en base a la longitud del texto del usuario y el hueco disponible (el ancho del marco)\n      const porcNombre = 75;\n      let xNombre;\n      let yNombre;\n      let cName;\n      let sNombre;\n      let nMarco;\n      let sceneData1 = {};\n\n      const ljug = inames.map((num) => num.length);\n\n      inames[0] === \"\" && inames.length === 1\n        ? (sNombre = null)\n        : (sNombre =\n            ((resultadofinal[0][14] / Math.max(...ljug)) * porcNombre * 2) /\n            100);\n\n      for (let i = 0; i < resultadofinal.length; i++) {\n        cName = resultadofinal[i][18];\n\n        cName === undefined\n          ? (xNombre = null)\n          : (xNombre =\n              100 * (1 - porcNombre / 100) * 0.5 +\n              ((1 - cName.length / Math.max(...ljug)) * porcNombre) / 2);\n\n        cName === undefined\n          ? (yNombre = null)\n          : (yNombre = 100 + Number(oveaba));\n\n        if (imarcos.length === 1) {\n          nMarco = imarcos[0];\n        } else {\n          i < imarcos.length ? (nMarco = imarcos[i]) : (nMarco = \"\");\n        }\n\n        sceneData1[i.toString()] = {\n          x: resultadofinal[i][12],\n          y: resultadofinal[i][13],\n          width: resultadofinal[i][14],\n          overlayImg: nMarco,\n          overlayLeft: Number(ioverlays[0]),\n          overlayRight: Number(ioverlays[2]),\n          overlayTop: Number(ioverlays[1]),\n          overlayBottom: Number(ioverlays[3]),\n          geometry: geometria,\n          filter: efecto,\n          cameraName: cName,\n          cameraNameOffsetX: xNombre,\n          cameraNameOffsetY: yNombre,\n          cameraNameFontSize: sNombre,\n          cameraNameColor: \"#000000\",\n          cameraNameFont: fuente,\n          fit: ajuste,\n        };\n      }\n      let sceneData2 = {\n        enable: true,\n        hide: {\n          navigation: false,\n          controls: false,\n          players: false,\n          sidebar: false,\n          hotbar: false,\n          mode: \"scene\",\n        },\n      };\n\n      let sceneData = { ...sceneData1, ...sceneData2 };\n\n      console.log(\"Datos de la escena:\");\n      console.log(sceneData);\n      console.log(\"---------------------------------\");\n      console.log(\"---------------------------------\");\n\n      game.falemos.putSceneConfig(null, JSON.stringify(sceneData));\n    }\n    if (saveMacro) game.falemos.sceneConfigToMacro();\n  },\n}).render(true);","folder":null,"sort":0,"flags":{"falemos":{"vaccinatorVersion":0}},"_id":"DShbuUHt4LR6Zkri","ownership":{"default":0,"4uIWgsMlc1aoAakz":3},"_stats":{"systemId":null,"systemVersion":null,"coreVersion":null,"createdTime":null,"modifiedTime":null,"lastModifiedBy":null}}
{"name":"New Macro","type":"chat","author":"Q3ETiyR9RS6Y0fMI","img":"icons/svg/dice-target.svg","scope":"global","command":"","folder":null,"sort":0,"flags":{},"_id":"PD5wdRU38rQ7IvLF","ownership":{"default":0,"Q3ETiyR9RS6Y0fMI":3},"_stats":{"systemId":null,"systemVersion":null,"coreVersion":null,"createdTime":null,"modifiedTime":null,"lastModifiedBy":null}}
{"name":"New Macro","type":"chat","author":"9XPkonCriaWtiahi","img":"icons/svg/dice-target.svg","scope":"global","command":"","folder":null,"sort":0,"flags":{},"_id":"V1jW9KYm89mb6dGc","ownership":{"default":0,"9XPkonCriaWtiahi":3},"_stats":{"systemId":null,"systemVersion":null,"coreVersion":null,"createdTime":null,"modifiedTime":null,"lastModifiedBy":null}}
{"name":"New Macro","type":"chat","author":"536BPBXI6N0LzeOu","img":"icons/svg/dice-target.svg","scope":"global","command":"","folder":null,"sort":0,"flags":{},"_id":"nsz1lW0D92PIhGic","ownership":{"default":0,"536BPBXI6N0LzeOu":3},"_stats":{"systemId":null,"systemVersion":null,"coreVersion":null,"createdTime":null,"modifiedTime":null,"lastModifiedBy":null}}
{"name":"New Macro","type":"chat","author":"xOVq779xlwxhhqkf","img":"icons/svg/dice-target.svg","scope":"global","command":"","folder":null,"sort":0,"flags":{},"_id":"p7qbdEIteSdZE4aE","ownership":{"default":0,"xOVq779xlwxhhqkf":3},"_stats":{"systemId":null,"systemVersion":null,"coreVersion":null,"createdTime":null,"modifiedTime":null,"lastModifiedBy":null}}
{"name":"New Macro","type":"chat","author":"jx6MjO5IFHLZVPmo","img":"icons/svg/dice-target.svg","scope":"global","command":"","folder":null,"sort":0,"flags":{},"_id":"s30vLZQ8vxPyau17","ownership":{"default":0,"jx6MjO5IFHLZVPmo":3},"_stats":{"systemId":null,"systemVersion":null,"coreVersion":null,"createdTime":null,"modifiedTime":null,"lastModifiedBy":null}}
{"name":"New Macro","type":"chat","author":"xOVq779xlwxhhqkf","img":"icons/svg/dice-target.svg","scope":"global","command":"","folder":null,"sort":0,"flags":{},"_id":"zA0HfMMC3t5LiF6Z","ownership":{"default":0,"xOVq779xlwxhhqkf":3},"_stats":{"systemId":null,"systemVersion":null,"coreVersion":null,"createdTime":null,"modifiedTime":null,"lastModifiedBy":null}}
